<!DOCTYPE html>
<html>
<head>
  <title>My Wonderland</title>
</head>
<body>
    <center>
      <h1>My Wonderland 詞句組合</h1>
      <div>
        <label for="attraction">景點名稱:<br></label>
        <input type="text" id="attraction">
        <br>
        <br>
        <label for="cardlist">詞卡編號(以,隔開):<br></label>
        <input type="text" id="cardlist">
        <br>
        <br>

        <button onclick="sendMessage()">詞句組合</button>
        <br>
        <br>
        <button id="sendButton">繳&nbsp;&nbsp;送</button>

      </div>
      <br>
      <br>
      <div id="output">
        <p>My Wonderland: 善用AI發揮創意，打造心中美麗世界，展開新奇探索旅程。</p>
      </div>
    </center>

    <script>

    function sendMessage() {
      const cardlist = document.getElementById('cardlist').value;
      if (cardlist) {
        var card=[  '壯觀的','遼闊的','迷人的','雄偉的','碧綠的','蔚藍的','多彩的','高聳的',
                    '蓬勃的','璀璨的','茂盛的','鮮豔的',
                    '荒涼的','污染的','混亂的','沈悶的','無趣的','陰鬱的','黯淡的','死寂的',
                    '山脈','河川','湖泊','瀑布','天空','星夜','雲朵','陽光','樹木','花朵',
                    '建築物','天際線','輕舟','飛鳥','晚霞'
                 ];

        const attraction = document.getElementById('attraction');
        const output = document.getElementById('output');
        output.innerHTML = "";
        
        try{
            var t1="";
            var t2="";
            var arr = cardlist.split(",");
            for(var i=0; i<arr.length; i++)
            {
                var d=parseInt(arr[i]);
                if(d>=1 && d<=20)
                {
                    d--;
                    t1 += card[d] + "、";
                }
                else if(d>=21 && d<=35)
                {
                    d--;
                    t2 += card[d] + "、";
                }
            }

            if(t1.length>1) t1=t1.substring(0,t1.length-1);
            if(t2.length>1) t2="，畫面中的元素包含" + t2.substring(0,t2.length-1);
            
            output.innerHTML = "一幅" + t1 + attraction.value + "景色" + t2 + "。";
        }
        catch
        {
              output.innerHTML = "error!";
        }

      }


        
        
        const accessToken = 'McXxU5YAzp9PWiDZC9qKal7hyDDnwHJ1AOeMuYKDQeZViEufYWR0bjrfmBCcHfBG0mee0nLvBUIAwW9D6/80QoPJw26ceScvZnwIZ01kIN4JgC7qvQb0+5nfDMt4NoQnDktyP82BD5/Z5heIFkLRzwdB04t89/1O/w1cDnyilFU=';

        
        const message = {
          to: 'U6ba7b948ca4f1288456df0f3065b5b10', 
          messages: [
            {
              type: 'text',
              text: output.innerHTML,
            },
          ],
        };


        
        // 发送消息函数
        const sendMessage = () => {
            
          const xhr = new XMLHttpRequest();
          const url = 'https://api.line.me/v2/bot/message/push';
          xhr.open('POST', url, true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.setRequestHeader('Authorization', `Bearer ${accessToken}`);
          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
              output.innerHTML+='傳送成功.';
            } else {
              output.innerHTML+='傳送失敗:' + xhr.responseText;
            }
          };
          xhr.send(JSON.stringify(message));
        };
        

    const sendButton = document.getElementById('sendButton');
    sendButton.addEventListener('click', sendMessage);


    }
    </script>
</body>
</html>